<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  
    <!-- Bootstrap link -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Stylesheet -->

    <link rel="stylesheet" href="/css/user/userprofile.css">

    <!-- Boxicon-icons  -->

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <style>
      .mainheading{
        background-image: url('/images/user/profile-background.jpg');
        background-size: cover;
        background-position: center;
      }
      .padding{
        height: 1rem;
      }
      .content{
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .content div{
        box-shadow: inset 0 0 10px rgb(255, 255, 255);
        padding: 5rem;
        border: 2px solid rgba(255, 255, 255, 0);
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        justify-content: start;
      }
      .invalid-feedback {
            display: none;
      }
      .is-invalid + .invalid-feedback {
            display: block;
      }
      .bx.bx-chevron-right.toggle {
      display: none;
      }
      ::-webkit-scrollbar-track {
      background-color: #000000; /* Color of the scrollbar track */
      }
      ::-webkit-scrollbar {
          width: 10px; /* Width of the scrollbar */
      }
      ::-webkit-scrollbar-thumb {
          background-color: #494747; /* Color of the scrollbar thumb */
          border-radius: 6px; /* Rounded corners of the scrollbar thumb */
      }
      @media screen and (max-width: 600px) {
        .bx.bx-chevron-right.toggle {
        display: block;
        }
      }
      input:-webkit-autofill,
      input:-webkit-autofill:hover, 
      input:-webkit-autofill:focus, 
      input:-webkit-autofill:active{
          -webkit-background-clip: text;
          -webkit-text-fill-color: #ffffff;
          transition: background-color 5000s ease-in-out 0s;
          box-shadow: inset 0 0 20px 20px #23232329;
      }
    </style>
    
</head>
<body>
  <body>

    <header class="header">

        <div class="navbar">
          <a href="/">Home</a>
          <a href="/product-list/list">Products</a>
        </div>
        <div class="search-bar-container">
          <form action="/product-list/search" method="get" class="search-bar">
            <input type="text" placeholder="Search..." name="search" id="search">
            <button type="submit"><box-icon name='search'><i class='bx bx-search'></i></button>
          </form>
        <div class="right_navbar">
          <a href="/user/wishlist"><i class='bx bx-heart'></i></a>
          <a href="/user/cart"><i class='bx bx-cart'></i></a>
          <a href="/user/profile"><i class='bx bx-user'></i></a>
          <form action="/user/logout" method="post"><button type="submit" class="login_navbar">Logout</button></form>
        </div>
        </div>
        
    </header>



  <nav class="sidebar">
    <header>
      <div class="image-text">
        <span class="image">
          <img src="#" alt="">
        </span>

        <div class="text logo-text">
          <span class="name">Alchemy</span>
          <span class="profession"><%= userName %></span>
        </div>
      </div>

      <i class='bx bx-chevron-right toggle'></i>
    </header>

    <div class="menu-bar">
      <div class="menu">

        <ul class="menu-links">
          <li class="nav-link">
            <a href="/user/profile" style="background-color: #183D3D;">
              <i class='bx bx-home-alt icon'></i>
              <span class="text nav-text">Profile</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/address">
              <i class='bx bx-map icon'></i>
              <span class="text nav-text">Manage Address</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/wishlist">
              <i class='bx bx-heart icon'></i>
              <span class="text nav-text">My Wishlist</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/order">
              <i class='bx bx-shopping-bag icon'></i>
              <span class="text nav-text">My orders</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/wallet">
              <i class='bx bx-wallet icon'></i>
              <span class="text nav-text">Wallet</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/coupon">
              <i class='bx bxs-coupon icon'></i>
              <span class="text nav-text">Coupon</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/chat">
              <i class='bx bxs-chat icon'></i>
              <span class="text nav-text">Chat</span>
            </a>
          </li>
          
        </ul>
      </div>
      
      </div>
    </div>

  </nav>

  <section class="home">

    <div class="container mainheading" >
      <div class="padding"></div>
      <div class="d-flex justify-content-center py-5 pb-0"><a href="/">Home</a>/Profile</div>
      <div class="text d-flex justify-content-center pb-5"> <h2 style="color: rgb(0, 0, 0);">Profile Information</h2></div>
    </div>

    <div class="container content py-5">

        <div>
          <p>Name : <span style="background-color: #181D31; padding: 3px; border-radius: 5px;"><%= user.name %></span></p>
          <p>Email : <span style="background-color: #181D31; padding: 3px; border-radius: 5px;"><%= user.email %></span></p>
          <p>Reeferral Code: <span style="background-color: #181D31; padding: 3px; border-radius: 5px;"><%= user.referralCode %></span></p>
          <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#changePassword" data-whatever="@getbootstrap">Change Password</button>
        </div>
      
    </div>

  </section>

  <!-- Change Password BOOTSTRAP MODAL BEGIN -->
 
  <div class="modal fade" id="changePassword" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Change Password</h5>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm" onsubmit="changePassword(event)">
                  <div id="serverError" class="text-danger"></div>
                    <div class="form-group">
                        <label for="currentPassword" class="col-form-label">Existing Password:</label>
                        <input type="password" class="form-control" id="currentPassword" name="currentPassword" placeholder="Current Password" required>
                        <div class="invalid-feedback">Please provide your current password.</div>
                    </div>
                    <div class="form-group">
                        <label for="newPassword" class="col-form-label">New Password:</label>
                        <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="New Password" required>
                        <div class="invalid-feedback">Please provide a new password.</div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="col-form-label">Confirm Password:</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required>
                        <div class="invalid-feedback">Passwords do not match.</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
  <!-- Change Password BOOTSTRAP MODAL END -->

        <!-- TOAST MESSAGE FOR Change Password BEGIN -->
      
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
          <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            
        <div class="toast-body d-flex justify-content-center align-items-center" style="background-color: rgb(255, 255, 255);  color: rgb(0, 0, 0);">
          <i class='bx bx-check'></i><p style="padding: 0; margin: 0;">Password Successfully Changed </p>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>
  
    <!-- TOAST MESSAGE FOR Change Password END -->

  <script>
    const body = document.querySelector('body'),
      sidebar = body.querySelector('nav'),
      toggle = body.querySelector(".toggle"),
      searchBtn = body.querySelector(".search-box"),
      modeSwitch = body.querySelector(".toggle-switch"),
      modeText = body.querySelector(".mode-text");
    toggle.addEventListener("click", () => {
      sidebar.classList.toggle("close");
    })
    searchBtn.addEventListener("click", () => {
      sidebar.classList.remove("close");
    })
    modeSwitch.addEventListener("click", () => {
      body.classList.toggle("dark");
      if (body.classList.contains("dark")) {
        modeText.innerText = "Light mode";
      } else {
        modeText.innerText = "Dark mode";
      }
    });
  </script>

<!-- Bootsrtap script -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>    
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script></body>

<script>
   function changePassword(event) {
            event.preventDefault();
            var form = document.getElementById('changePasswordForm');
            var newPassword = document.getElementById('newPassword');
            var confirmPassword = document.getElementById('confirmPassword');
            var serverError = document.getElementById('serverError');

            // Reset validation feedback
            newPassword.classList.remove('is-invalid');
            confirmPassword.classList.remove('is-invalid');

            // Check if the new password and confirmation password match
            if (newPassword.value !== confirmPassword.value) {
                confirmPassword.classList.add('is-invalid');
                return;
            }
            const form_data=new FormData(event.target)
            let json_form={};
            form_data.forEach((value,key)=>{
              json_form[key]=value;
            })
            fetch("/user/changePassword",{
              method:"PUT",
              headers:{
                "Content-Type":"application/json"
              },
              body:JSON.stringify(json_form)

            })
            .then((response)=>{
              if(!response.ok){
                return response.json();
              }else{
                form.reset(); // Reset form after successful submission
                $('#changePassword').modal('hide'); // Hide the modal
                toastBootstrap.show();
              }
              
            })
            .then((data)=>{
              serverError.textContent=data.message
            })
            .catch((err)=>console.log("Error"))

        }
</script>
</body>

</html>