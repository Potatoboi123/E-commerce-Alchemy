<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  
    <!-- Bootstrap link -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Stylesheet -->

    <link rel="stylesheet" href="/css/user/userprofile.css">
    
    <!-- Boxicon-icons  -->
    
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <link rel="stylesheet" href="/css/user/wishlist.css">
  </head>
  <body>
    <body>
      
      <header class="header">
        
        <div class="navbar">
          <a href="/">Home</a>
          <a href="/product-list/list">Products</a>
        </div>
        <div class="search-bar-container">
          <form action="/product-list/search" method="get" class="search-bar">
            <input type="text" placeholder="Search..." name="search" id="search">
            <button type="submit"><box-icon name='search'><i class='bx bx-search'></i></button>
          </form>
        <div class="right_navbar">
          <a href="/user/wishlist"><i class='bx bx-heart'></i></a>
          <a href="/user/cart"><i class='bx bx-cart'></i></a>
          <a href="/user/profile"><i class='bx bx-user'></i></a>
          <form action="/user/logout" method="post"><button type="submit" class="login_navbar">Logout</button></form>
        </div>
        </div>
        
    </header>



  <nav class="sidebar">
    <header>
      <div class="image-text">
        <span class="image">
          <img src="#" alt="">
        </span>

        <div class="text logo-text">
          <span class="name">Alchemy</span>
          <span class="profession"><%= userName %></span>
        </div>
      </div>

      <i class='bx bx-chevron-right toggle'></i>
    </header>

    <div class="menu-bar">
      <div class="menu">

        <ul class="menu-links">
          <li class="nav-link">
            <a href="/user/profile">
              <i class='bx bx-home-alt icon'></i>
              <span class="text nav-text">Profile</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/address">
              <i class='bx bx-map icon'></i>
              <span class="text nav-text">Manage Address</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/wishlist" style="background-color: #183D3D;">
              <i class='bx bx-heart icon'></i>
              <span class="text nav-text">My Wishlist</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/order">
              <i class='bx bx-shopping-bag icon'></i>
              <span class="text nav-text">My orders</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/wallet">
              <i class='bx bx-wallet icon'></i>
              <span class="text nav-text">Wallet</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/coupon">
              <i class='bx bxs-coupon icon'></i>
              <span class="text nav-text">Coupon</span>
            </a>
          </li>

          <li class="nav-link">
            <a href="/user/chat">
              <i class='bx bxs-chat icon'></i>
              <span class="text nav-text">Chat</span>
            </a>
          </li>
          
        </ul>
      </div>
      
      </div>
    </div>

  </nav>

  <section class="home">
    
    <div class="container mainheading" >
      <div class="padding"></div>
      <div class="d-flex justify-content-center py-5 pb-0"><a href="/">Home</a>/Wishlist</div>
      <div class="text d-flex justify-content-center pb-5"> <h2 style="color: rgb(0, 0, 0);">Wishlist</h2></div>
    </div>

    <div class="container p-5 py-0">

      <% if(wishlist.items.length==0) {%>
        <h2 style="text-align: center; color: white;">No Items In Wishlist</h2>
      <% }else{ %>

        <% wishlist.items.forEach(((item,index)=>{ %>
          <div class="row m-4 d-flex wishlist-item" id="wishlist-item-<%= index %>" style="border: 2px solid rgb(255, 255, 255); border-radius: 10px;">

            <div class="col-12 col-md-8">
              <a href="/product-details/<%= item._id %>" class="d-flex align-items-center" style="justify-content: space-between;">
                <img src="<%= item.image[0] %>" alt="productimage" style="width: 7rem; height: 7rem;">
                <p class="m-0 ml-2"><%= item.name %></p>
                <p class="m-0 ml-2">â‚¹<%= item.discountPrice %></p>
              </a>
            </div>
            <div class="col-12 col-md-3 d-flex align-items-center justify-content-md-end justify-content-center">
              <button class="btn btn-dark add-cart" onclick="addCart(`<%= item._id %>`)">Add To Cart</button>
            </div>
              <div class="col-12 col-md-1 d-flex align-items-center justify-content-md-end justify-content-center">
                <button type="button" id="btn-deletwishlist" onclick="deleteWishlist('wishlist-item-<%= index %>','<%= item._id %>')"><i class='bx bxs-trash-alt'></i></button>
              </div>
            </div>
        <% })) %>
        <% } %>
      </div>
      
    </section>

    <!-- Bootsrtap script -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>    
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script></body>


    <script>
      
      /* ADD product to cart BEGIN */
      
      function addCart(id){
        
        fetch("/user/add_cart/"+id,{
          method:"POST",
          headers:{
            "Content-Type":"application/json"
          }
        })
      .then((response)=>{
        if(response.ok){
          Swal.fire({
            title: 'Product Added',
            text: 'Your product has been added to the cart.',
            icon: 'success',
            showCancelButton: true,
            cancelButtonText: 'Close',
            showConfirmButton: true,
            confirmButtonText: 'Go to Cart',
            allowOutsideClick: false
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = '/user/cart';
            }
          });
        }else{
          return response.json();
        }
      })
      .then((data)=>{
        if(data.outOfStock){
          Swal.fire({
            title: "Out Of Stock",
            text: "The product is not in stock.",
            icon: "error"
          });
        }else if(data.maxQuantity){
          Swal.fire({
            title: "Max Limit",
            text: "Reached max quantity for the product",
            icon: "error"
          });
        }else{
          throw new Error("Something Happened")
        }
      })
      .catch((err)=>{
        console.log("Something Happened")
      })
      
    }

    /* ADD product to cart END */

    /* Delete Product From Wishlist BEGIN */

    function deleteWishlist(removeId,itemId){

      Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, delete it!"
      }).then((result) => {
        if (result.isConfirmed) {
          fetch("/user/deleteWishlist/"+itemId,{
            method:"DELETE"
          })
          .then((response)=>{
            if(response.ok){
              let itemElement = document.getElementById(removeId);
              if (itemElement) {
                itemElement.remove();
              }
/*               if(document.querySelectorAll(".wishlist-item").length==0){
                document.querySelector(".container")
                <h2 style="text-align: center; color: white;">No Items In Wishlist</h2>
              } */
              Swal.fire({
                title: "Deleted!",
                text: "Product Remved From Wishlist.",
                icon: "success"
              });
            }else{
              Swal.fire({
                title: "Sorry",
                text: "Sorry For The Inconvenince.We are Currently working on a solution.",
                icon: "error"
              });
            }
          })
          .catch((err)=>{console.log("error")})
        }
      })
      .catch((err)=>{console.log("error")})
      }

    /* Delete Product From Wishlist END */

    </script>

<script>
  
  /*     document.getElementById("abutton").addEventListener("click", function(event) {
    event.stopPropagation(); // Prevent click event from reaching the anchor tag
  }); */
  
  const body = document.querySelector('body'),
  sidebar = body.querySelector('nav'),
  toggle = body.querySelector(".toggle"),
  searchBtn = body.querySelector(".search-box"),
  modeSwitch = body.querySelector(".toggle-switch"),
  modeText = body.querySelector(".mode-text");
  toggle.addEventListener("click", () => {
    sidebar.classList.toggle("close");
    })
    searchBtn.addEventListener("click", () => {
      sidebar.classList.remove("close");
    })
    modeSwitch.addEventListener("click", () => {
      body.classList.toggle("dark");
      if (body.classList.contains("dark")) {
        modeText.innerText = "Light mode";
      } else {
        modeText.innerText = "Dark mode";
      }
    });
  </script>

</body>

</html>