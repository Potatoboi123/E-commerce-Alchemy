<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,700;0,800;1,200;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="/css/user/cart/animate.css">
    
    <link rel="stylesheet" href="/css/user/cart/owl.carousel.min.css">
    <link rel="stylesheet" href="/css/user/cart/owl.theme.default.min.css">
    <link rel="stylesheet" href="/css/user/cart/magnific-popup.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.min.css">
    
    <link rel="stylesheet" href="/css/user/cart/flaticon.css">
    <link rel="stylesheet" href="/css/user/cart/style.css">

    <!-- Boxicon-icons  -->

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <style>
      /* Loader Begin */

.overlay{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}
.loader {
    width: 48px;
    height: 48px;
    border: 5px solid #FFF;
    border-bottom-color: #FF3D00;
    border-radius: 50%;
    display: inline-block;
    box-sizing: border-box;
    animation: rotation 1s linear infinite;
    }

    @keyframes rotation {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
    } 
    

  /* Loader End */
        body{
            background-color: black;
        }

        .table tbody td{

            background-color: black;
        }
        .form-control{
            background-color: black;
            color: white;
        }
        .form-control:focus{
            background-color: black !important;
            color: white !important;
        }
        .checkmark:after{
            color: rgba(199, 42, 42, 0.353);
        }
        .alert{
            border: 1px solid black;
        }
        .close i{
          color: red;
        }
        .add-sub{
          cursor: pointer;
          border-radius: 7px;
          margin-top: 10px;
          height: 30px;
          width: 20px;
        }
        /*  */
        .modal-content{
        color: white;
        background-color: rgb(45, 43, 43);
      }
      .form-control{
        background-color: transparent;
        color: white;
      }
      .modal-content ::placeholder {
        color: #afaaaa; 
      }
      .modal-content input:focus::placeholder {
        color: #afaaaa; 
      }
        /*  */

        .form-control:focus {
    border-color: #ced4da; /* Change this to the color you want */
    box-shadow: none; /* Optionally remove box-shadow */
  }
    </style>
  </head>
  <body>

    <div class="overlay">
      <span class="loader"></span>
    </div>

    <header class="header">

        <nav class="navbar">
          <a href="/home">Home</a>
          <a href="/product-list/list">Products</a>
        </nav>
        <div class="search-bar-container">
			<form action="/product-list/search" method="get" class="search-bar">
				<input type="text" placeholder="Search..." name="search" id="search">
				<button type="submit"><box-icon name='search'><i class='bx bx-search'></i></button>
			</form>
        <div class="right_navbar">
          <a href="/user/wishlist"><i class='bx bx-heart'></i></a>
          <a href="/user/cart"><i class='bx bx-cart'></i></a>
          <a href="/user/profile"><i class='bx bx-user'></i></a>
          <form action="/user/logout" method="post" ><button type="submit" class="login_navbar">Logout</button></form>
        </div>
        </div>
        
    </header>

    <section class="hero-wrap hero-wrap-2" style="background-image: url('/images/product/bg_2.jpg');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
          <div class="row no-gutters slider-text align-items-end justify-content-center">
            <div class="col-md-9 ftco-animate mb-5 text-center">
                <p class="breadcrumbs mb-0"><span class="mr-2"><a href="/home">Home <i class="fa fa-chevron-right"></i></a></span> <span>Checkout <i class="fa fa-chevron-right"></i></span></p>
              <h2 class="mb-0 bread" >Checkout</h2>
            </div>
          </div>
        </div>
      </section>
  
      
  <div class="container" style="margin-top: 3rem;">
    <main>
  
      <div class="row g-5">
        <div class="col-md-5 col-lg-4 order-md-last">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary">Your cart</span>
            <span class="badge bg-primary rounded-pill"><%= cart.items.length %></span>
          </h4>
          <ul class="list-group mb-3">
            <% cart.items.forEach((item)=>{ %>

              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0"><%= item.product.name %></h6>
                  <small class="text-body-secondary"><%= item.product.category.name %></small>
                </div>
                <span class="text-body-secondary">$<%= item.product.price %></span>
              </li>
            <% }) %>
            <li class="list-group-item d-flex justify-content-between bg-body-tertiary">
              <div class="text-success">
                <h6 class="my-0">Promo code</h6>
                <small>EXAMPLECODE</small>
              </div>
              <span class="text-success">-$5</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Total (USD)</span>
              <strong>$<%= cart.totalPrice %></strong>
            </li>
          </ul>
  
          <form class="card p-2">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Promo code">
              <button type="submit" class="btn btn-secondary">Redeem</button>
            </div>
          </form>
        </div>

        
        <div class="col-md-7 col-lg-8">
          <form class="needs-validation" onsubmit="checkout(event)" novalidate>
         <!-- 00 -->
         <h4 class="mb-3" style="color: white;">Select Address</h4>
         <div class="form-group">
          <label for="exampleFormControlSelect1">Address</label>
          <select class="form-control" id="exampleFormControlSelect1" name="address">
            <% addresses.forEach((address)=>{ %>
              <option value="<%= address._id %>"><%= address.name %>,<%= address.phoneNo %>,<%= address.address %>,<%= address.locality %>,<%= address.city %>,<%= address.state %>-<%= address.pincode %></option>
            <% }) %>
            
          </select>
        </div>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@getbootstrap">Add Address</button>
         <!-- 11 -->

        <h4 class="mb-3" style="color: white;">Select Payment Method</h4>

        <div class="my-3">
          <div class="form-check">
            <input id="credit" name="paymentMethod" type="radio" class="form-check-input" value="credit" checked required>
            <label class="form-check-label" for="credit">Credit card</label>
          </div>
          <div class="form-check">
            <input id="debit" name="paymentMethod" type="radio" class="form-check-input" value="debit" required>
            <label class="form-check-label" for="debit">Debit card</label>
          </div>
          <div class="form-check">
            <input id="paypal" name="paymentMethod" type="radio" class="form-check-input" value="paypal" required>
            <label class="form-check-label" for="paypal">PayPal</label>
          </div>
          <div class="form-check">
            <input id="cashOnDelivery" name="paymentMethod" type="radio" class="form-check-input" value="cashOnDelivery" required>
            <label class="form-check-label" for="paypal">Cash On Delivery</label>
          </div>
        </div>

        <button class="w-100 btn btn-primary btn-lg" type="submit">Order Now</button>
       </form>
      </div>
      </div>
        <!--  -->
        
    </main>
  
    
  </div>

    <!-- ADD ADDRESS BOOTSTRAP MODAL BEGIN -->
 
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Address</h5>
      </div>
      <div class="modal-body">
        <form onsubmit="addAddress(event)">
          <div class="form-group">
            <label for="name" class="col-form-label">Name:</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Name" required="true">
          </div>
          <div class="form-group">
            <label for="phoneNo" class="col-form-label">Phone:</label>
            <input type="number" class="form-control" id="phoneNo" name="phoneNo" placeholder="10-digit mobile number" required="true">
          </div>
          <div class="form-group">
            <label for="pincode" class="col-form-label">Pincode:</label>
            <input type="number" class="form-control" id="pincode" name="pincode" placeholder="Pincode" required="true">
          </div>
          <div class="form-group">
            <label for="locality" class="col-form-label">Locality:</label>
            <input type="text" class="form-control" id="locality" name="locality" placeholder="Locality" required="true">
          </div>
          <div class="form-group">
            <label for="address" class="col-form-label">Address:</label>
            <textarea class="form-control" id="address" name="address" placeholder="Address(Area and Street)" required="true"></textarea>
          </div>
          <div class="form-group">
            <label for="city" class="col-form-label">City/District/Town:</label>
            <input type="text" class="form-control" id="city" name="city" placeholder="City/District/Town" required="true">
          </div>
          <div class="form-group">
            <label for="state" class="col-form-label">State:</label>
            <input type="text" class="form-control" id="state" name="state" placeholder="State" required="true">
          </div>
          <div class="form-group">
            <label for="landmark" class="col-form-label">Landmark:</label>
            <input type="text" class="form-control" id="landmark" name="landmark" placeholder="Landmark(Optional)">
          </div>
          <div class="form-group">
            <label for="alternateNo" class="col-form-label">Alternate Phone no:</label>
            <input type="number" class="form-control" id="alternateNo" name="alternateNo" placeholder="Alternate Phone No(Optional)">
          </div>

          <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>

        </form>
      </div>
      
    </div>
  </div>
</div>
  <!-- ADD ADDRESS BOOTSTRAP MODAL END -->
  <script>
    /* ADD Address BEGIN */
    function addAddress(event){
      event.preventDefault()
      const form_data=new FormData(event.target)
      let json_form={};
      form_data.forEach((value,key)=>{
        json_form[key]=value;
      })
      /* 

      Validation Goes Here

       */
      fetch("/user/add_address",{
        method:"POST",
        headers:{
          "Content-Type":"application/json"
        },
        body:JSON.stringify(json_form)
      })
      .then((response)=>{
        if(!response.ok){
          return response.json()
        }else{
          window.location.href="/user/checkout";
        }
      })
      .then((data)=>{
        console.log(data.message)
        Swal.fire(data.message);
      })
      .catch((err)=>{
        Swal.fire("Some Error Occured.");
      })
    }

    /* ADD Address END */
    /* Checkout BEGIN */
    function checkout(event){
      event.preventDefault()
      const form_data=new FormData(event.target)
      let json_form={};
      form_data.forEach((value,key)=>{
        json_form[key]=value;
      })
      /* 

      Validation Goes Here

       */
      fetch("/user/checkout",{
        method:"POST",
        headers:{
          "Content-Type":"application/json"
        },
        body:JSON.stringify(json_form)
      })
      .then((response)=>{
          return response.json();
        
      })
      .then((data)=>{
        if(data.error){
          return Swal.fire(data.error);
        }
        Swal.fire({
            title: 'Order Placed',
            text: 'Your Order has been placed.',
            icon: 'success',
            showCancelButton: true,
            cancelButtonText: 'Continue Browsing',
            showConfirmButton: true,
            confirmButtonText: 'Go To Your Order',
            allowOutsideClick: false
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/user/order';
                }else{
                  window.location.href = '/product-list/list';
                }
            });
      })
      .catch((err)=>{
        Swal.fire("Some Error Occured.");
      })
    }
    /* heckout END */
  </script>
  


  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>   
  <script src="/js/user/cart/jquery.min.js"></script>
  <script src="/js/user/cart/jquery-migrate-3.0.1.min.js"></script>
  <script src="/js/user/cart/popper.min.js"></script>
  <script src="/js/user/cart/bootstrap.min.js"></script>
  <script src="/js/user/cart/jquery.easing.1.3.js"></script>
  <script src="/js/user/cart/jquery.waypoints.min.js"></script>
  <script src="/js/user/cart/jquery.stellar.min.js"></script>
  <script src="/js/user/cart/owl.carousel.min.js"></script>
  <script src="/js/user/cart/jquery.magnific-popup.min.js"></script>
  <script src="/js/user/cart/jquery.animateNumber.min.js"></script>
  <script src="/js/user/cart/scrollax.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="/js/google-map.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
  <script src="/js/user/cart/main.js"></script>

    
  </body>
</html>